{% extends "base.html" %} {% block content %}
<div class="container mt-5">
  <h1 class="mb-4">CSRF 공격</h1>
  <p>
    아래는 비밀번호 변경과 관련된 코드 스니펫입니다. 이 코드는 CSRF 토큰을
    사용하지 않아 CSRF 공격에 취약합니다. 주어진 코드의 취약점을 찾아내고 이를
    이용해 admin 사용자의 비밀번호를 변경하세요.
  </p>

  <pre class="p-3 border bg-light">
    <code>
      @app.route("/change_password", methods=["GET"])
      def change_password():
          pw = request.args.get("pw", "")
          session_id = request.cookies.get('sessionid', None)
          try:
              username = session_storage[session_id]
          except KeyError:
              return render_template('index.html', text='로그인해 주세요')

          users[username] = pw
          return '비밀번호가 변경되었습니다'
    </code>
  </pre>

  <hr />

  <form method="get" action="{% url 'short_answer_question' type %}">
    <div class="form-group">
      <label for="payload"><strong>공격 페이로드</strong></label>
      <input
        type="text"
        name="payload"
        id="payload"
        class="form-control"
        placeholder="<img src=..."
      />
    </div>
    <button type="submit" class="btn btn-primary">공격 시도</button>
  </form>

  <hr />

  {% if successful %}
  <div class="alert alert-success mt-3">
    정답입니다! CSRF 공격이 성공하여 admin 사용자의 비밀번호가 변경되었습니다.
  </div>
  <a
    href="{% url 'short_answer_question_explanation' type %}"
    class="btn btn-success mt-3"
    >설명 보러가기</a
  >
  <a href="{% url 'solve' %}" class="btn btn-secondary mt-3"
    >다른 문제 풀어보기</a
  >
  {% elif unsuccessful %}
  <div class="alert alert-danger mt-3">
    CSRF 공격에 실패했습니다. 다른 접근 방법을 시도해보세요.
  </div>
  <button
    class="btn btn-link mt-3"
    onclick="document.getElementById('hint').style.display='block'"
  >
    힌트 보기
  </button>
  <div id="hint" class="alert alert-warning mt-3" style="display: none">
    {{ hint }}
  </div>
  {% endif %}
</div>
{% endblock %}
