{% extends "base.html" %} {% block content %}{% load static %}
<head>
<meta charset="utf-8">
<title>haribo</title>
<style>
html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
.container { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; }
#text-target { width: 50%; cursor: pointer; }
.tada { animation: 1s tada infinite; }
@keyframes tada {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}
</style>
</head>

<body>
<div class="container">
  <h1>하리보를 쓰다듬어주세요!</h1>
  <img id="text-target" src="https://i.namu.wiki/i/5PNrq2_YMOVKjhQVZpeaMFXOmxoWQRWzWTXZpXHHTEa2M-AXqT2Yhe2CLhYz-6Hp3VTrl7OWnkiThaBRTY-qvw.webp" alt="haribo" height="400" width="400"/>
  <canvas width=720 height=150></canvas>
  <p><span id="clicks">10000</span>번 더 쓰다듬기!</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script>
var textArray = [ 135, 208, 184, 172, 242, 195, 161, 167, 171, 115, 176, 145, 117, 156, 108, 230, 74, 146 ];
var counter = 0;
var haribo = 1;

function make() {
  if (counter > 10000) {
    $('#text-target').addClass('tada');
    var ctx = document.querySelector("canvas").getContext("2d"),
    dashLen = 220, dashOffset = dashLen, speed = 20,
    txt = textArray.map(x=>String.fromCharCode(x)).join(''), x = 30, i = 0;

    ctx.font = "50px Comic Sans MS, cursive, TSCu_Comic, sans-serif"; 
    ctx.lineWidth = 5; ctx.lineJoin = "round"; ctx.globalAlpha = 2/3;
    ctx.strokeStyle = ctx.fillStyle = "#1f2f90";

    (function loop() {
      ctx.clearRect(x, 0, 60, 150);
      ctx.setLineDash([dashLen - dashOffset, dashOffset - speed]);
      dashOffset -= speed;
      ctx.strokeText(txt[i], x, 90);

      if (dashOffset > 0) requestAnimationFrame(loop);
      else {
        ctx.fillText(txt[i], x, 90);
        dashOffset = dashLen;
        x += ctx.measureText(txt[i++]).width + ctx.lineWidth * Math.random();
        ctx.setTransform(1, 0, 0, 1, 0, 3 * Math.random());
        ctx.rotate(Math.random() * 0.005);
        if (i < txt.length) requestAnimationFrame(loop);
      }
    })();
  }
  else {
    $('#clicks').text(10000 - counter);
  }
}

$(function() {
  $('#text-target').click(function () {
    counter += 1;
    if (counter <= 10000 && counter % 100 == 0) {
      for (var i = 0; i < textArray.length; i++) {
        textArray[i] ^= haribo;
        haribo = ((haribo ^ 0xff) + (i * 10)) & 0xff;
      }
    }
    make();
  });
});
</script>
</body>

{% endblock %}
