{% extends "base.html" %} {% block content %}
<div class="container mt-5">
  <h1 class="mb-4">파일 다운로드 취약점</h1>
  <p>
    파일 다운로드 기능은 사용자가 서버에서 파일을 다운로드할 수 있도록 합니다.
    그러나 파일 경로가 적절하게 검증되지 않으면 공격자가 서버의 임의의 파일을
    다운로드할 수 있는 취약점이 발생할 수 있습니다. 아래 양식을 사용하여 파일
    다운로드 기능을 이용해 서버의 민감한 파일을 다운로드해보세요.
  </p>
  <pre class="p-3 border">
def download_file(request):
    file_path = request.GET.get("file")
    if file_path:
        file_path = os.path.join(BASE_DIR, "uploads", file_path)
        if os.path.exists(file_path):
            with open(file_path, "rb") as f:
                response = HttpResponse(f.read(), content_type="application/octet-stream")
                response["Content-Disposition"] = f'attachment; filename="{os.path.basename(file_path)}"'
                return response
    return HttpResponseNotFound("파일을 찾을 수 없습니다")
</pre
  >

  <hr />

  <form method="get">
    {% csrf_token %}
    <div class="form-group">
      <label for="file">파일 경로</label>
      <input
        type="text"
        name="file"
        id="file"
        class="form-control"
        placeholder="입력"
      />
    </div>
    <button type="submit" class="btn btn-primary">파일 다운로드</button>
  </form>

  {% if successful %}
  <div class="alert alert-success mt-3">
    축하합니다! 민감한 파일을 성공적으로 다운로드했습니다.
  </div>
  <a href="{% url 'file_download_explanation' %}" class="btn btn-success mt-3"
    >설명 보러가기</a
  >
  <a href="{% url 'solve' %}" class="btn btn-secondary mt-3"
    >다른 문제 풀어보기</a
  >
  {% elif unsuccessful %}
  <div class="alert alert-danger mt-3">
    파일 다운로드에 실패했습니다. 다른 접근 방법을 시도해보세요.
  </div>
  <button
    class="btn btn-link mt-3"
    onclick="document.getElementById('hint').style.display='block'"
  >
    힌트 보기
  </button>
  <div id="hint" class="alert alert-warning mt-3" style="display: none">
    {{ hint }}
  </div>
  {% endif %}
</div>
{% endblock %}
